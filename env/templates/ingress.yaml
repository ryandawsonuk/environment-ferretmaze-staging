apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: {{ .Release.Name }}-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/enable-cors: "true"
    nginx.ingress.kubernetes.io/cors-allow-headers: "X-Forwarded-For, X-Forwarded-Proto, X-Forwarded-Port, X-Forwarded-Prefix"
    nginx.ingress.kubernetes.io/x-forwarded-prefix: "true"
    nginx.org/websocket-services: "{{ .Release.Name }}-activiti-cloud-query"
spec:
  rules:
  - host: jx-staging-quickstart-http.jx-staging.activiti.envalfresco.com
    http:
      paths:
      - path: /rb-my-app
        backend:
          serviceName: {{ .Release.Name }}-example-runtime-bundle
          servicePort: 80
      - path: /
        backend:
          serviceName: {{ .Release.Name }}-keycloak-http
          servicePort: 80
      - path: /rabbitmq
        backend:
          serviceName: {{ .Release.Name }}-rabbitmq
          servicePort: 15672
#      - path: /audit
#        backend:
#          serviceName: {{ .Release.Name }}-activiti-cloud-audit
#          servicePort: 80
      - path: /query
        backend:
          serviceName: {{ .Release.Name }}-activiti-cloud-query
          servicePort: 80
# to test ws would need to configure apollo to use path
# as apollo client no longer expects to be on a gw path - https://github.com/Activiti/activiti-cloud-query-service/commit/0e05bf321d59d7373c5c0fa40506b514704dc92c