apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: {{ .Release.Name }}-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/enable-cors: "true"
    nginx.ingress.kubernetes.io/cors-allow-headers: "X-Forwarded-For, X-Forwarded-Proto, X-Forwarded-Port, X-Forwarded-Prefix"
    nginx.ingress.kubernetes.io/x-forwarded-prefix: "true"
#    nginx.org/websocket-services: "ws-svc"
spec:
  rules:
  - host: jx-staging-quickstart-http.jx-staging.activiti.envalfresco.com
    http:
      paths:
      - path: /rb-my-app
        backend:
          serviceName: {{ .Release.Name }}-example-runtime-bundle
          servicePort: 80
      - path: /
        backend:
          serviceName: {{ .Release.Name }}-keycloak-http
          servicePort: 80
      - path: /rabbitmq
        backend:
          serviceName: {{ .Release.Name }}-rabbitmq
          servicePort: 15672
      - path: /query
        backend:
          serviceName: {{ .Release.Name }}-activiti-cloud-query
          servicePort: 80
# for ws would need to set ws port and ideally configure path to match apollo
#      - path: /ws
#        backend:
#          serviceName: {{ .Release.Name }}-activiti-cloud-query
#          servicePort: 8008